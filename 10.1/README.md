Домашнее задание к занятию "13.Системы мониторинга"

1. Вас пригласили настроить мониторинг на проект. 
На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. 
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. 
Какой минимальный набор метрик вы выведите в мониторинг и почему?

Ответ:

CPU - Мониторинг нагрузки на CPU
RAM - Контроль свободных ресурсов памяти и потребления
HTTP/Request - Мониторинг общего количества запросов к системе
HTTP/Answers - Мониторинг от ответов(400/500) для определения доступности ресурса
HDD - Мониторинг свободного места на диске + (скорость чтение/запись)
LAN - Мониторинг сетевой нагрузки для анализа и планирования сети
Inodes - Мониторинг свободных дескрипторов, дабы избежать остановки сервиса
Service - Мониторинг службы веб сервиса на предмет доступности

2. Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. 
Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. 
Что вы можете ему предложить?

Ответ:

RAM - это объем установленной и доступной оперативной памяти для запуска приложений. 
Отсутствие, либо малый объем свободной RAM может приводить к "зависанияю" программ и "задумчивости" системы в целом

inodes - это каксималькое количество файлов в системе, которое может быть записано на диск, 
Если свободных inode не будет, в систему ничего не получится записать даже при наличии места на диске

CPUla - Средняя загрузка процессора, для обработки запросов. Чем выше показатель - тем хуже для системы в целом


3. Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. 
Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. 
Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

Ответ:

Можно написать скрипт, который будет собирать данные из папки: /proc/ и выкладывать их в общедоступное место для разработчиков.
Для поддержания данных в актуальном состоянии настраиваем расписание через Сron.


4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. 
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. 
Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. 
Где у вас ошибка?

Ответ:
В формуле учитываются только 200 ответы, которые деляться на общее количество запросов.
Для правильного расчета нужно изменить формулу: (summ_1xx_requests+summ_2xx_requests+summ_3xx_requests)/sum_all_requests.

5. Опишите основные плюсы и минусы pull и push систем мониторинга.

Ответ:

Плюсы PULL Систем мониторинга:

1) Легче контролировать подлинность данных
2) Можно настроить единый proxy server до всех агентов с TLS
3) Упрощённая отладка получения данных с агентов

Минусы PULL Систем мониторинга:

1) Задержка в получении данных: так как данные собираются только при запросе, может возникать некоторая задержка в получении актуальной информации
2) Нагрузка на сеть: при активном использовании pull системы может возникать большая нагрузка на сеть при каждом запросе на получение данных.
3) Ограниченная возможность мониторинга в режиме реального времени: pull система может не обеспечивать возможность мониторинга в режиме реального времени из-за задержки в получении данных.


Плюсы PUSH Систем мониторинга:

1) Упрощение репликации данных в разные системы мониторинга или их резервные копии
2) более гибкая настройка отправки пакетов данных с метриками
3) UDP — это менее затратный способ передачи данных, из-за чего может возрасти производительность сбора метрик

Минусы PUSH Систем мониторинга:

1) Высокая нагрузка на ресурсы: push системы активно передают данные в режиме реального времени, что может приводить к высокой нагрузке на ресурсы и сеть.
2) Сложность настройки и интеграции: push системы требуют более сложной настройки и интеграции с приложениями и устройствами.
3) Потенциальные проблемы безопасности: так как push системы активно передают данные, может возникать потенциальная угроза безопасности при передаче конфиденциальной информации.

6. Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

Prometheus - Pull
TICK - Push
Zabbix - Pull & Push
VictoriaMetrics - Pull & Push
Nagios - Pull

7. Склонируйте себе репозиторий и запустите TICK-стэк, используя технологии docker и docker-compose.
В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (http://localhost:8888).


8. Перейдите в веб-интерфейс Chronograf (http://localhost:8888) и откройте вкладку Data explorer.

Нажмите на кнопку Add a query
Изучите вывод интерфейса и выберите БД telegraf.autogen
В measurments выберите cpu->host->telegraf-getting-started, а в fields выберите usage_system. Внизу появится график утилизации cpu.
Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.
Для выполнения задания приведите скриншот с отображением метрик утилизации cpu из веб-интерфейса.

9. Изучите список telegraf inputs. Добавьте в конфигурацию telegraf следующий плагин - docker:

```sh

[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"

```

Дополнительно вам может потребоваться донастройка контейнера telegraf в docker-compose.yml дополнительного volume и режима privileged:

```sh

 telegraf:
    image: telegraf:1.4.0
    privileged: true
    volumes:
      - ./etc/telegraf.conf:/etc/telegraf/telegraf.conf:Z
      - /var/run/docker.sock:/var/run/docker.sock:Z
    links:
      - influxdb
    ports:
      - "8092:8092/udp"
      - "8094:8094"
      - "8125:8125/udp"

```

После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список measurments в веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.
